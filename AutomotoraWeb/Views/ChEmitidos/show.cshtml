@model DLL_Backend.CuentaBancaria
@using AutomotoraWeb.Helpers;
@using DLL_Backend;
@using AutomotoraWeb.Controllers.General;

@{
    ViewBag.Title = ViewBag.NombreEntidades;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row-fluid">

    @using (Html.BeginForm()) {
        @Html.ValidationSummary(true)
        @Html.ValidationSummary("Se han producido errores:")

        <div>
            <div class="display-label">
                Cuenta Bancaria:
            </div>
            <div class="editor-field editor-field-xlarge xxlarge">
                @Html.DdlOrDisplayFor(model => model.Codigo, (bool?)ViewBag.SoloLectura, model => model.Nombre,
                new SelectList(ViewBag.Cuentas, "Codigo", "Nombre"), "--Seleccionar Cuenta--",
                new { id = "ddlCuentas", @class = "xxlarge" })
                @Html.ValidationMessageFor(model => model.Codigo)
            </div>
        </div>
        <div class="clear-both"></div>

        <div class="btn-toolbar botoneraListado">
            <div class="btn-group" style="margin-left: 10px">
                <input type="submit" id="Submit2" class="btn btn-primary2-mf" name="btnSubmit" value="Actualizar" />
            </div>

            <div class="btn-group">
                @*@(Html.Bootstrap().ActionLinkButton("Agregar ", BaseController.CREATE).AppendIcon(TwitterBootstrapMVC.Icons.plus, true).Style(TwitterBootstrap2.ButtonStyle.Primary))*@
                @(Html.Bootstrap().Button().Text(" Agregar").AppendIcon(TwitterBootstrapMVC.Icons.plus, true).Style(TwitterBootstrap2.ButtonStyle.Primary).Id("btn_agregar"))
            </div>

            <div class="btn-group">
                <a class="btn btn-primary2-mf" title="Listados" href='@Url.Action("List")'>Listados</a>
            </div>
            <div class="btn-group">
                @(Html.Bootstrap().ActionLinkButton("Debitar ","Debitar").Style(TwitterBootstrap2.ButtonStyle.Default))
            </div>

        </div>
    }

    <div id="divGrilla">
        @Html.Partial("_listGrilla", Model.ChequesEmitidosPendientes())
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
            $("#ddlCuentas").attr("data-val-required", "La cuenta es requerida");
        }
    );

    $("#btn_agregar").click(function() {
        window.location.href = '/ChEmitidos/Create/' + $('#ddlCuentas').val();
    });

    $('#ddlCuentas').change(function () {
        /* Get the selected value of dropdownlist */
        var selectedID = $(this).val();
        //alert(selectedID);
        $.ajax({
            cache: false,
            type: "GET",
            url: '/ChEmitidos/CuentaSelected/',
            data: { "idCuenta": selectedID },
            success: function (data) {
                $('#divGrilla').html('');
                $('#divGrilla').html(data);
            },
            error: function (xhr, ajaxOptions, thrownError) {

                alert('Error al traer los datos.');
            },
            beforeSend: showLoading,
            complete: hideLoading
        });
    });

</script>
